<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Francesco Napolitano" />


<title>Getting started with the repo R Data Manager</title>

<script src="index_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="index_files/highlight/default.css"
      type="text/css" />
<script src="index_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Getting started with the <em>repo</em> R Data Manager</h1>
<h4 class="author"><em>Francesco Napolitano</em></h4>
<h4 class="date"><em>Mon Jun 29 00:33:45 2015</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#preparation">Preparation</a></li>
<li><a href="#populating-a-repository">Populating a repository</a><ul>
<li><a href="#storing-a-dataset">Storing a dataset</a></li>
<li><a href="#attaching-visualizations">Attaching visualizations</a></li>
<li><a href="#storing-some-results">Storing some results</a></li>
</ul></li>
<li><a href="#looking-at-the-repository">Looking at the repository</a><ul>
<li><a href="#repository-summary">Repository summary</a></li>
<li><a href="#listing-items">Listing items</a></li>
<li><a href="#showing-dependencies">Showing dependencies</a></li>
</ul></li>
<li><a href="#accessing-items-in-the-repo">Accessing items in the repo</a></li>
<li><a href="#to-be-continued">To be continued</a></li>
</ul>
</div>

<br>
<p style="text-align:right">
<strong><em>“Thou Shalt Not save() Or load()”</em></strong><br> <em>first commandment of the repo user</em>
</p>
<p><br></p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This is a short getting started guide to the repo package, which implements an R objects repository manager. Instead of manually storing and retrieving R objects into and from the appropriate directories and files, repo offers an abstraction layer that takes care of storing, retrieving and sorting the objects. For each stored object, you provide a name, a description, a list of tags and optional dependence and provenance information. Repo will store the object together with all the metadata an provide easy access to it. Repo can display a compact list of all the items stored and provide search by tags, load in the workspace, remove from disk, export to RDS files, edit metadata, manage provenance traces, show dependency graph and more. In the following, an example of use will guide you through the main features of repo.</p>
</div>
<div id="preparation" class="section level2">
<h2>Preparation</h2>
<p>Here we define some global variables and load the necessary libraries. First of all, in order to use repo, we load the repo library:</p>
<pre class="r"><code># library(repo)</code></pre>
<p>Among annotations that can be added to items stored in the repo there’s the provenance trace, which basically answers the question: where does this come from? The following string will be used as a provenance trace for all the data produced by this script. It is basically the full path to the file containing this script (the documentation you’re reading has ben generated by a script called repodemo.R).</p>
<pre class="r"><code>src &lt;- normalizePath(&quot;repodemo.R&quot;)</code></pre>
<p>However, to hide paths from my disk, here I will owerwrite <em>src</em> with the following:</p>
<pre class="r"><code>src &lt;- &quot;repodemo.R&quot;</code></pre>
<p>This command creates a new repon in “./repodemo” or open an existing one in the same directory. To avoid confirmation requests during the generation of this document, they’re turned off through the <em>forceYes</em> parameter. The variable <em>repo</em> will be used as the main interface to the repository. I’m suppressing messages to hide personal info.</p>
<pre class="r"><code>repo &lt;- suppressMessages(repo_open(&quot;repodemo&quot;))</code></pre>
<p>The <em>knitr</em> library is loaded just for the function <em>kable</em>, used in this demo to pretty-print tables. I also set a knitr option just for cosmetic reasons.</p>
<pre class="r"><code>library(knitr)
opts_chunk$set(comment=NA)</code></pre>
</div>
<div id="populating-a-repository" class="section level2">
<h2>Populating a repository</h2>
<p>First of all, we will populate the repository with some data, starting with the Iris dataset (included in most R distributions). We will perform a dimensionality reduction through Principal Component Analysis (PCA) and a clustering through K-means. We will store the data into the repo and <em>attach</em> some visualizations. Attached items are generated from generic files on the disk as opposed to R objects.</p>
<div id="storing-a-dataset" class="section level3">
<h3>Storing a dataset</h3>
<p>The Iris dataset is readily found in the <em>datasets</em> R package. However, we will store our normalized version of it in the repo. We will separately store the normalized data matrix and the class labels. The code for normalization will be a simple call to <em>scale</em>:</p>
<pre class="r"><code>myiris &lt;- scale(as.matrix(iris[,1:4]))</code></pre>
<p>In order to properly store our normalized <em>myiris</em>, we will need to call <em>repo$put</em> and provide the following parameters:</p>
<ul>
<li><p><strong>obj</strong> The varialbe containing the object that we want to store: <em>myiris</em>.</p></li>
<li><p><strong>name</strong> An identifier for the variable. At the moment any string is accepted, but this may change in favour of sanitized names. Best practice is to use a short name without special characters.</p></li>
<li><p><strong>description</strong> A verbose description of the variable contents.</p></li>
<li><p><strong>tags</strong> A set of tags. Tags are used to subset the repo for many purposes, for example if you want to be able to select only items produced by this script, make sure to add one tag accordingly (<em>repodemo</em> in this case).</p></li>
<li><p><strong>src</strong> The source that generated the data, that is the file name containing this script.</p></li>
<li><p><strong>replace</strong> A boolean that tells repo wether to overwrite an existing entry by the same name. I set it to true so that I can run this script repeatedly without issues. (This documentation is generated from an R script).</p></li>
</ul>
<p>Thus, the following call to the <em>put</em> method will store the contents of <em>myiris</em> in the repo. The data will be actually saved in the repo root in RDS format.</p>
<pre class="r"><code>repo$put(obj = myiris,
         name = &quot;myiris&quot;,
         description = paste(&quot;A normalized version of the iris dataset coming with R.&quot;,
             &quot;Normalization is made with the scale function with default parameters.&quot;),
         tags = c(&quot;dataset&quot;, &quot;iris&quot;, &quot;repodemo&quot;),
         src = src,
         replace=T)</code></pre>
</div>
<div id="attaching-visualizations" class="section level3">
<h3>Attaching visualizations</h3>
<p>The Iris dataset is 4D and PCA can be used to produce a 2D visualization. The following code produces such visualization and shows it:</p>
<pre class="r"><code>irispca &lt;- princomp(myiris)        
iris2d &lt;- irispca$scores[,c(1,2)]
plot(iris2d, main=&quot;2D visualization of the Iris dataset&quot;, col=iris$Species)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" title="" alt="" width="672" /></p>
<p>Wouldn’t it be cool to store the visualization in the repo and somehow link it to the iris data? This can be done exploiting the <em>attach</em> method, which can store any file in the repo as is, together with usual annotations (description, tags, etc.). Internally, <em>attach</em> calls <em>put</em>, so it is very similar. Two differences in the parameters of this call are worth noting:</p>
<ul>
<li><p><strong>filepath</strong> Instead of an identifier, <em>attach</em> takes a file name (with path). The file name will be also the item identifier. This behaviour can be overridden by calling <em>put</em> with the <em>asattachment</em> parameter set to TRUE.</p></li>
<li><p><strong>to</strong> This parameter tells repo which item this one is attached to.</p></li>
</ul>
<pre class="r"><code>pdf(&quot;iris2D.pdf&quot;)
plot(iris2d, main=&quot;2D visualization of the Iris dataset&quot;, col=iris$Species)
invisible(dev.off())
repo$attach(&quot;iris2D.pdf&quot;, &quot;Iris 2D visualization obtained with PCA.&quot;,
            c(&quot;visualization&quot;, &quot;iris&quot;, &quot;repodemo&quot;), src, replace=T, to=&quot;myiris&quot;)</code></pre>
<p><em>attach</em> actually makes a copy of the attached file to the repo root, so we can get rid of the copy in the working directory:</p>
<pre class="r"><code>invisible(file.remove(&quot;iris2D.pdf&quot;))</code></pre>
<p>But is the 2D visualization good enough for a 4D dataset? This can be checked by looking at the PCA eigenvalues, as follows.</p>
<pre class="r"><code>plot(irispca)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" title="" alt="" width="672" /></p>
<p>In the future, when I look at the 2D visualization, I want to remember its “accuracy” according to the PCA eigenvalues. So I will attach the plot of the PCA eigenvalues to the plot of the 2D visualization. This is attaching to an attachment and it’s ok.</p>
<pre class="r"><code>pdf(&quot;irispca.pdf&quot;)
plot(irispca)
invisible(dev.off())
repo$attach(&quot;irispca.pdf&quot;, &quot;Variance explained by the PCs of the Iris dataset&quot;,
            c(&quot;visualization&quot;, &quot;iris&quot;, &quot;repodemo&quot;), src, replace=T, to=&quot;iris2D.pdf&quot;)
invisible(file.remove(&quot;irispca.pdf&quot;))</code></pre>
</div>
<div id="storing-some-results" class="section level3">
<h3>Storing some results</h3>
<p>The following code makes a clustering of the Iiris data and stores it in the repo. There still one more interesting parameter here:</p>
<ul>
<li><strong>depends</strong> This tells repo that, in order to compute the <em>kiris</em> variable containing the clustering, I need data previously stored, that is <em>myiris</em>. This dependency annotation is not mandatory at all, however it helps to keep things sorted as the repo grows.</li>
</ul>
<pre class="r"><code>kiris &lt;- kmeans(myiris, 5)$cluster
repo$put(kiris, &quot;iris_5clu&quot;, &quot;Kmeans clustering of the Iris data, k=5.&quot;,
         c(&quot;metadata&quot;, &quot;iris&quot;, &quot;kmeans&quot;, &quot;clustering&quot;, &quot;repodemo&quot;), src,
         depends=&quot;myiris&quot;, T)</code></pre>
<p>Let’s see what the clustering looks like. This is the same 2D visualization as before, except that colors are given by clustering labels instead of class labels. Just for the purpose of making the repo a bit more interesting, we will add <em>put</em> this visualization. Note the dependency.</p>
<pre class="r"><code>plot(iris2d, main=&quot;Iris dataset kmeans clustering&quot;, col=kiris)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" title="" alt="" width="672" /></p>
<p>Not so nice, but who cares! Let’s put it in the repo:</p>
<pre class="r"><code>pdf(&quot;iris2Dkm.pdf&quot;)
plot(iris2d, main=&quot;Iris dataset kmeans clustering&quot;, col=kiris)
invisible(dev.off())
repo$attach(&quot;iris2Dkm.pdf&quot;, &quot;Iris K-means clustering.&quot;,
            c(&quot;visualization&quot;, &quot;iris&quot;, &quot;clustering&quot;, &quot;kmeans&quot;, &quot;repodemo&quot;), src,
            replace=T, to=&quot;iris_5clu&quot;)
invisible(file.remove(&quot;iris2Dkm.pdf&quot;))</code></pre>
<p>Finally, let’s compute a contingency table of the classes versus clusters and store it in the repo. For some reason, we don’t really care about this precise result, but we want it in the repo in case we need it in the future. This is why we add the reserved tag <em>hide</em>, which will prevent this item from being shown by default. Attachments are automatically <em>hide</em>-tagged by default.</p>
<pre class="r"><code>res &lt;- table(iris$Species, kiris)
repo$put(res, &quot;iris_cluVsSpecies&quot;,
         paste(&quot;Contingency table of the kmeans clustering versus the&quot;,
               &quot;original labels of the Iris dataset.&quot;),
         c(&quot;result&quot;, &quot;iris&quot;,&quot;validation&quot;, &quot;clustering&quot;, &quot;repodemo&quot;, &quot;hide&quot;),
         src, c(&quot;myiris&quot;, &quot;iris_5clu&quot;), T)</code></pre>
</div>
</div>
<div id="looking-at-the-repository" class="section level2">
<h2>Looking at the repository</h2>
<p>In this section we will have a look at the repository just created, as a whole. In particular, we will show a summary of the repo and its dependency graph</p>
<div id="repository-summary" class="section level3">
<h3>Repository summary</h3>
<p>The <em>info</em> method provides details about repo items, but when called without orguments it shows some self-explaining information about the repo:</p>
<pre class="r"><code>repo$info()</code></pre>
<pre><code>Root:            ~/git/bbuck/repo/repodemo 
Number of items: 6 
Total size:      18.36 kB </code></pre>
</div>
<div id="listing-items" class="section level3">
<h3>Listing items</h3>
<p>The repo library supports an S3 <em>print</em> method that shows the contents of the repo. All non-hidden items will be shown, together with some details, which by defaults are: name, dimensions, size.</p>
<pre class="r"><code>repo ## by default resolves to print(repo)</code></pre>
<pre><code>        ID  Dims                                         Tags    Size
    myiris 150x4                      dataset, iris, repodemo 1.82 kB
 iris_5clu   150 metadata, iris, kmeans, clustering, repodemo   113 B</code></pre>
<p>As expected, hidden items are not shown. Use the following to make all the items appear:</p>
<pre class="r"><code>print(repo, all=T)</code></pre>
<pre><code>                ID  Dims
            myiris 150x4
       @iris2D.pdf     -
      @irispca.pdf     -
         iris_5clu   150
     @iris2Dkm.pdf     -
 iris_cluVsSpecies   3x5
                                                 Tags    Size
                              dataset, iris, repodemo 1.82 kB
                        visualization, iris, repodemo 5.84 kB
                        visualization, iris, repodemo 4.38 kB
         metadata, iris, kmeans, clustering, repodemo   113 B
    visualization, iris, clustering, kmeans, repodemo 6.03 kB
 result, iris, validation, clustering, repodemo, hide   180 B</code></pre>
<p>Items can also be listed selectively. With the following call, only items tagged with “clustering” will be shown:</p>
<pre class="r"><code>print(repo, tags=&quot;clustering&quot;, all=T)</code></pre>
<pre><code>                ID Dims
         iris_5clu  150
     @iris2Dkm.pdf    -
 iris_cluVsSpecies  3x5
                                                 Tags    Size
         metadata, iris, kmeans, clustering, repodemo   113 B
    visualization, iris, clustering, kmeans, repodemo 6.03 kB
 result, iris, validation, clustering, repodemo, hide   180 B</code></pre>
<p>All attachments have the <em>attachment</em> tag, so they can be selectively visualized this way:</p>
<pre class="r"><code>print(repo, tags=&quot;attachment&quot;, all=T)</code></pre>
<pre><code>            ID Dims                                              Tags
   @iris2D.pdf    -                     visualization, iris, repodemo
  @irispca.pdf    -                     visualization, iris, repodemo
 @iris2Dkm.pdf    - visualization, iris, clustering, kmeans, repodemo
    Size
 5.84 kB
 4.38 kB
 6.03 kB</code></pre>
<p>For the same reasons, one may want to show only hidden items:</p>
<pre class="r"><code>#print(repo, tags=&quot;hide&quot;, all=T)</code></pre>
<p>Finally, also the columns shown can be slected. Let’s show only the tags:</p>
<pre class="r"><code>#repo$print(show=&quot;t&quot;, all=T)</code></pre>
</div>
<div id="showing-dependencies" class="section level3">
<h3>Showing dependencies</h3>
<p>In the previous sections we set dependencies for some items, in order to remember that they needed other items to be computed. In addition, some items were stored as attachment to other items. Finally, we annotated all the items as being produced by this script. In repo, all these relations are summarized in the <em>dependency graph</em>. The formal representation of the graph is a matrix, in which the entry (i,j) represent a relation from i to j of type 1, 2 or 3 (<em>dependency</em>, <em>attachment</em> or <em>generation</em>). Here’s how it looks like:</p>
<pre class="r"><code>depgraph &lt;- repo$dependencies(plot=F)
kable(depgraph)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">myiris</th>
<th align="right">iris2D.pdf</th>
<th align="right">irispca.pdf</th>
<th align="right">iris_5clu</th>
<th align="right">iris2Dkm.pdf</th>
<th align="right">iris_cluVsSpecies</th>
<th align="right">repodemo.R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">myiris</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">iris2D.pdf</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">irispca.pdf</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">iris_5clu</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">iris2Dkm.pdf</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">iris_cluVsSpecies</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">repodemo.R</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Omitting the <em>plot=F</em> parameter, the <em>dependencies</em> method will plot the dependency graph. This plot requires the <em>igraph</em> library.</p>
<pre class="r"><code>repo$dependencies()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" title="" alt="" width="672" /></p>
<p>This is a small repo and all resources were created by the same script, so the “generated” edges are not interesting. The three types of edges can be shown selectively, so here’s how the graph looks like without the “generated” edges:</p>
<pre class="r"><code>repo$dependencies(generated=F)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" title="" alt="" width="672" /></p>
</div>
</div>
<div id="accessing-items-in-the-repo" class="section level2">
<h2>Accessing items in the repo</h2>
<p>Of course, the only purpose of storing things is to retrieve them later, and this is why the most used command in repo is <em>get</em>. It’s meaning is very straightforward. The following command retrieves the variable <em>myiris</em> from the repo and loads it into the variable <em>x</em> in the current environment.</p>
<pre class="r"><code>x &lt;- repo$get(&quot;myiris&quot;)</code></pre>
<p>To get additional information about the entry, the <em>info</em> command can be used this way:</p>
<pre class="r"><code>repo$info(&quot;myiris&quot;)</code></pre>
<pre><code>ID:           myiris
Description:  A normalized version of the iris dataset coming with R. Normalization is made with the scale function with default parameters.
Tags:         dataset, iris, repodemo
Dimensions:   150x4
Timestamp:    2015-06-29 00:33:46
Size on disk: 1.82 kB
Provenance:   repodemo.R
Attached to:  -
Stored in:    /home/users/napolitano/git/bbuck/repo/repodemo/ae/8c/b5/ae8cb58a595aa3446f10e9fa4dfd4954
MD5 checksum: 3502270a48ecd8c798a026203327da70</code></pre>
</div>
<div id="to-be-continued" class="section level2">
<h2>To be continued</h2>
<p>This document is still in progress… please be patient.</p>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
